"""General IED module"""

import time
from pymodbus.client import ModbusTcpClient  # pylint: disable-msg=E0611

time.sleep(5)
status = {"S-IED1": False, "S-IED2": False, "S-IED3": False, "S-IED4": False,
          "T-IED1": False, "T-IED2": False, "T-IED3": False,
          "M-IED1": False, "M-IED2": False,
          "G-IED1": False}

if __name__ == '__main__':
    print("Run")
    while True:
        client = ModbusTcpClient('127.0.0.1', 502)
        result = client.read_coils(0, 10)
        
        splc = ModbusTcpClient("192.168.72.45", 502)
        splc.write_coil(0, result.bits[0])
        splc.write_coil(1, result.bits[1])
        splc.write_coil(2, result.bits[2])
        splc.write_coil(3, result.bits[3])
        splc.close()
        
        tplc = ModbusTcpClient("192.168.72.61", 502)
        tplc.write_coil(0, result.bits[4])
        tplc.write_coil(1, result.bits[5])
        tplc.write_coil(2, result.bits[6])
        tplc.close()
        
        mplc = ModbusTcpClient("192.168.72.29", 502)
        mplc.write_coil(0, result.bits[7])
        mplc.write_coil(1, result.bits[8])
        mplc.close()

        gplc = ModbusTcpClient("192.168.72.82", 502)
        gplc.write_coil(0, result.bits[9])        
        gplc.close()

        time.sleep(1)

        splc = ModbusTcpClient("192.168.72.45", 502)
        readSPLC = splc.read_coils(8, 25)
        client.write_coil(22, readSPLC.bits[0])
        status["S-IED1"] = readSPLC.bits[0]
        client.write_coil(23, readSPLC.bits[8])
        status["S-IED2"] = readSPLC.bits[8]
        client.write_coil(24, readSPLC.bits[16])
        status["S-IED3"] = readSPLC.bits[16]
        client.write_coil(25, readSPLC.bits[24])
        status["S-IED4"] = readSPLC.bits[24]
        splc.close()
        
        f = open("status.txt", "w", encoding="utf-8")
        for key, value in status.items():
            f.write('%s:%s\n' % (key, value))
        f.close()

        client.close()
        time.sleep(1)
